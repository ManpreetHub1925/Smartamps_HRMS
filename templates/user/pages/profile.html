<!DOCTYPE html>

<html lang="en" data-theme="light" data-sidebar="indigo" data-color="primary" data-topbar="bluegradient"
    data-layout="modern" data-topbarcolor="white" data-card="shadow" data-size="default" data-width="fluid"
    data-loader="enable">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <meta name="description" content="SmartAmps - Bootstrap Admin Template">
    <meta name="keywords" content="admin, estimates, bootstrap, business, html5, responsive, Projects">
    <meta name="author" content="SmartAmps - Bootstrap Admin Template">
    <meta name="robots" content="noindex, nofollow">
    <title>SmartAmps Admin Dashboard</title>


    {% include 'user/head_foot/style.html' %}


<body>


    <!-- Main Wrapper -->
    <div class="main-wrapper">


        {% include 'user/head_foot/header.html' %}


        <!-- Page Wrapper -->
        <div class="page-wrapper">
            <div class="content">

                <!-- Breadcrumb -->
                <div class="d-md-flex d-block align-items-center justify-content-between page-breadcrumb mb-3">
                    <div class="my-auto mb-2">
                        <h2 class="mb-1">Profile </h2>
                        <nav>
                            <ol class="breadcrumb mb-0">
                                <li class="breadcrumb-item">
                                    <a href="{{ url_for(session.role ~'.dashboard') }}"><i
                                            class="ti ti-smart-home"></i></a>
                                </li>
                                <li class="breadcrumb-item">
                                    Pages
                                </li>
                                <li class="breadcrumb-item active" aria-current="page">Profile </li>
                            </ol>
                        </nav>
                    </div>
                    <div class="head-icons ms-2">
                        <a href="javascript:void(0);" class="" data-bs-toggle="tooltip" data-bs-placement="top"
                            data-bs-original-title="Collapse" id="collapse-header">
                            <i class="ti ti-chevrons-up"></i>
                        </a>
                    </div>
                </div>
                <!-- /Breadcrumb -->

                <div class="card">
                    <div class="card-body">
                        <div class="border-bottom mb-3 pb-3 d-flex justify-content-between align-items-center">
                            <h4 class="mb-0">Profile</h4>
                            <button class="btn btn-primary" data-bs-toggle="modal"
                                data-bs-target="#passwordModal">Change Password</button>
                        </div>


                        <form method="POST" enctype="multipart/form-data" action="{{ url_for('auth.profile') }}">
                            <div class="border-bottom mb-3">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div>
                                            <h6 class="mb-3">Basic Information</h6>
                                            <div
                                                class="d-flex align-items-center flex-wrap row-gap-3 bg-light w-100 rounded p-3 mb-4">
                                                <div
                                                    class="d-flex align-items-center justify-content-center avatar avatar-xxl rounded-circle border border-dashed me-2 flex-shrink-0 text-dark frames">
                                                    <img id="profilePreview"
                                                        src="{{ url_for('static', filename='assets/img/profiles/' ~ (user_details.profile_pic_url if user_details.profile_pic_url else 'avatar-01.jpg')) }}"
                                                        alt="Profile Preview" class="rounded-circle" width="80"
                                                        height="80">
                                                </div>
                                                <div class="profile-upload">
                                                    <div class="mb-2">
                                                        <h6 class="mb-1">Profile Photo</h6>
                                                        <p class="fs-12">Recommended image size is 40px x 40px</p>
                                                    </div>
                                                    <div class="profile-uploader d-flex align-items-center">
                                                        <div class="drag-upload-btn btn btn-sm btn-primary me-2">
                                                            Upload
                                                            <input type="file" class="form-control image-sign"
                                                                multiple="" name="profile_photo" accept="image/*"
                                                                id="profile_photo">
                                                        </div>
                                                        <a href="javascript:void(0);" class="btn btn-light btn-sm"
                                                            id="cancel_upload">Cancel</a>

                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="row align-items-center mb-3">
                                            <div class="col-md-4">
                                                <label class="form-label mb-md-0">First Name</label>
                                            </div>
                                            <div class="col-md-8">
                                                <input type="text" class="form-control" name="first_name"
                                                    value="{{ user_details.first_name if user_details else '' }}"
                                                    id="first_name" readonly>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row align-items-center mb-3">
                                            <div class="col-md-4">
                                                <label class="form-label mb-md-0">Last Name</label>
                                            </div>
                                            <div class="col-md-8">
                                                <input type="text" class="form-control" name="last_name"
                                                    value="{{ user_details.last_name if user_details else '' }}"
                                                    id="last_name" readonly>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row align-items-center mb-3">
                                            <div class="col-md-4">
                                                <label class="form-label mb-md-0">Email</label>
                                            </div>
                                            <div class="col-md-8">
                                                <input type="text" class="form-control" name="email"
                                                    value="{{ user_details.email if user_details else '' }}" id="email"
                                                    required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row align-items-center mb-3">
                                            <div class="col-md-4">
                                                <label class="form-label mb-md-0">Phone</label>
                                            </div>
                                            <div class="col-md-8">
                                                <input type="text" class="form-control" name="phone"
                                                    value="{{ user_details.phone if user_details else '' }}" id="phone"
                                                    required>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="border-bottom mb-3">
                                <h6 class="mb-3">Departmental Details</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="row align-items-center mb-3">
                                            <div class="col-md-4">
                                                <label class="form-label mb-md-0">Role</label>
                                            </div>
                                            <div class="col-md-8">
                                                <input type="text" class="form-control" name="role"
                                                    value="{{ user_details.role_name if user_details else '' }}"
                                                    id="role" readonly>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row align-items-center mb-3">
                                            <div class="col-md-4">
                                                <label class="form-label mb-md-0">Department</label>
                                            </div>
                                            <div class="col-md-8">
                                                <input type="text" class="form-control" name="department"
                                                    value="{{ user_details.department_name if user_details else '' }}"
                                                    id="department" readonly>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row align-items-center mb-3">
                                            <div class="col-md-4">
                                                <label class="form-label mb-md-0">Designation</label>
                                            </div>
                                            <div class="col-md-8">
                                                <input type="text" class="form-control" name="designation"
                                                    value="{{ user_details.designation_name if user_details else '' }}"
                                                    id="designation" readonly>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row align-items-center mb-3">
                                            <div class="col-md-4">
                                                <label class="form-label mb-md-0">Reporting Manager Name</label>
                                            </div>
                                            <div class="col-md-8">
                                                <input type="text" class="form-control" name="reporting_manager_id"
                                                    value="{{ user_details.reporting_manager_name ~ ' (' ~ user_details.reporting_manager_id ~ ')' if user_details else '' }}"
                                                    id="reporting_manager_id" readonly>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="border-bottom mb-3">
                                <h6 class="mb-3">Address Information</h6>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="row align-items-center mb-3">
                                            <div class="col-md-2">
                                                <label class="form-label mb-md-0">Address</label>
                                            </div>
                                            <div class="col-md-10">
                                                <input type="text" class="form-control" name="address"
                                                    value="{{ user_details.address if user_details else '' }}"
                                                    id="address" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row align-items-center mb-3">
                                            <div class="col-md-4">
                                                <label class="form-label mb-md-0">City</label>
                                            </div>
                                            <div class="col-md-8">
                                                <input type="text" class="form-control" name="city"
                                                    value="{{ user_details.city if user_details else '' }}" id="city"
                                                    required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row align-items-center mb-3">
                                            <div class="col-md-4">
                                                <label class="form-label mb-md-0">State</label>
                                            </div>
                                            <div class="col-md-8">
                                                <div>
                                                    <select class="form-select" name="state" id="state" required>
                                                        <option disabled {% if not user_details or not user_details.state %}selected{% endif %}>Select</option>
                                                        <option value="UP" {% if user_details and user_details.state == 'UP' %}selected{% endif %}>UP</option>
                                                        <option value="UK" {% if user_details and user_details.state == 'UK' %}selected{% endif %}>UK</option>
                                                        <option value="GB Nagar" {% if user_details and user_details.state == 'GB Nagar' %}selected{% endif %}>GB Nagar</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row align-items-center mb-3">
                                            <div class="col-md-4">
                                                <label class="form-label mb-md-0">Country</label>
                                            </div>
                                            <div class="col-md-8">
                                                <div>
                                                    <select class="select" name="country" id="country" required>
                                                        <option disabled {% if not user_details or not user_details.country %}selected{% endif %}>Select</option>
                                                        <option value="India" {% if user_details and user_details.country == 'India' %}selected{% endif %}>India</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row align-items-center mb-3">
                                            <div class="col-md-4">
                                                <label class="form-label mb-md-0">Postal Code</label>
                                            </div>
                                            <div class="col-md-8">
                                                <input type="text" class="form-control" name="pincode"
                                                    value="{{ user_details.pincode if user_details else '' }}"
                                                    id="pincode" required>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- <div class="border-bottom mb-3">
                                <h6 class="mb-3">Change Password</h6>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="row align-items-center mb-3">
                                            <div class="col-md-5">
                                                <label class="form-label mb-md-0">Current Password</label>
                                            </div>
                                            <div class="col-md-7">
                                                <div class="pass-group">
                                                    <input type="password" class="pass-input form-control"
                                                        name="current_password"
                                                        value="{{ user_details.password if user_details else '' }}"
                                                        id="current_password" required>
                                                    <span class="ti toggle-password ti-eye-off"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="row align-items-center mb-3">
                                            <div class="col-md-5">
                                                <label class="form-label mb-md-0">New Password</label>
                                            </div>
                                            <div class="col-md-7">
                                                <div class="pass-group">
                                                    <input type="password" class="pass-inputs form-control"
                                                        name="new_password"
                                                        value="{{ user_details.new_password if user_details else '' }}"
                                                        id="new_password" required>
                                                    <span class="ti toggle-passwords ti-eye-off"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="row align-items-center mb-3">
                                            <div class="col-md-5">
                                                <label class="form-label mb-md-0">Confirm Password</label>
                                            </div>
                                            <div class="col-md-7">
                                                <div class="pass-group">
                                                    <input type="password" class="pass-inputa form-control"
                                                        name="confirm_password"
                                                        value="{{ user_details.confirm_password if user_details else '' }}"
                                                        id="confirm_password" required>
                                                    <span class="ti toggle-passworda ti-eye-off"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div> -->
                            <div class="d-flex align-items-center justify-content-end">
                                <button type="button" class="btn btn-outline-light border me-3">Cancel</button>
                                <button type="submit" class="btn btn-primary">Save</button>
                            </div>
                        </form>


                    </div>
                </div>
            </div>

            <!-- Password Reset Form Hidden -->
            <div class="modal fade" id="passwordModal" tabindex="-1" aria-labelledby="passwordModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <form method="POST" action="{{ url_for('auth.change_password') }}">
                            <div class="modal-header">
                                <h5 class="modal-title" id="passwordModalLabel">Change Password</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label for="current_password" class="form-label">Current Password</label>
                                    <input type="password" class="form-control" name="current_password" required>
                                </div>
                                <div class="mb-3">
                                    <label for="new_password" class="form-label">New Password</label>
                                    <input type="password" class="form-control" name="new_password" required>
                                </div>
                            </div>
                            <div class="d-flex align-items-center justify-content-end">
                                <button type="submit" class="btn btn-primary m-2">Update Password</button>
                                <button type="button" class="btn btn-outline-light border me-3" data-bs-dismiss="modal">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            {% include 'user/head_foot/footer.html' %}

        </div>
        <!-- /Page Wrapper -->


    </div>
    <!-- /Main Wrapper -->

    {% include 'user/head_foot/scripts.html' %}

    <script>
        document.getElementById("change_password_btn").addEventListener("click", function () {
            const form = document.getElementById("password_form");
            form.style.display = form.style.display === "none" ? "block" : "none";
        });
    </script>

    <script>
        document.getElementById("profile_photo").addEventListener("change", function (event) {
            const file = event.target.files[0];
            const preview = document.getElementById("profilePreview");

            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById("cancel_upload").addEventListener("click", function () {
            const fileInput = document.getElementById("profile_photo");
            const preview = document.getElementById("profilePreview");

            fileInput.value = "";  // clear input

            // Reset to existing image or default
            preview.src = "{{ url_for('static', filename='assets/img/profiles/' ~ (user_details.profile_pic_url if user_details.profile_pic_url else 'avatar-01.jpg')) }}";
        });
    </script>

</body>

</html>